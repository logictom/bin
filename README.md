# Google Calendar Bin Collection Reminder

This project automates the process of fetching bin collection dates from the Gateshead Council website and adding them as events to a Google Calendar.

## Prerequisites

*   Python 3
*   `pip` (Python package installer)
*   ChromeDriver: Ensure it's installed and in your system's PATH, or specify its location in `bins.py`.
*   Google Calendar API credentials:
    *   `credentials.json`: Obtained from Google Cloud Console.
    *   `token.pickle`: Generated after authorizing the application for the first time. This file stores user's access and refresh tokens.

## Setup

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd <repository-directory>
    ```

2.  **Install Python dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **Set up Google Calendar API Credentials:**
    *   Follow the instructions in the [Python Quickstart](https://developers.google.com/calendar/api/quickstart/python) guide to enable the Google Calendar API and download your `credentials.json` file.
    *   Place the `credentials.json` file in the root directory of this project.
    *   The first time you run `caltest.py` or `hello.py` (or any script that interacts with the Google Calendar API), it will attempt to open a browser window for you to authorize access. After successful authorization, a `token.pickle` file will be created in the same directory. This file should be kept secure.

4.  **ChromeDriver:**
    *   Download the version of ChromeDriver that matches your Chrome browser version from [here](https://chromedriver.chromium.org/downloads).
    *   Ensure `chromedriver` is in your system's PATH or update the path to the executable directly in `bins.py` if it's placed elsewhere.
        ```python
        # Example in bins.py if chromedriver is not in PATH
        # driver = webdriver.Chrome(executable_path='/path/to/chromedriver', options=chrome_options)
        ```

## Usage

The primary workflow involves two main scripts:

1.  **`bins.py`**: Scrapes bin collection information.
    *   This script connects to the Gateshead Council website to find bin collection dates for a specified address.
    *   It requires a postcode and a house number/name as command-line arguments.
    *   The output is a JSON file named `bins.json` containing the collection schedule.

    ```bash
    python bins.py -p "YOUR_POSTCODE" -n "YOUR_HOUSE_NUMBER"
    ```
    Replace `"YOUR_POSTCODE"` and `"YOUR_HOUSE_NUMBER"` with the actual details. For example:
    ```bash
    python bins.py -p "NE216EZ" -n "10"
    ```

2.  **`caltest.py`**: Adds bin collection events to Google Calendar.
    *   This script reads the `bins.json` file (generated by `bins.py`) and creates events in your Google Calendar.
    *   It requires your Google Calendar ID and the path to the JSON file as command-line arguments.
    *   It also creates a "Trigger" event for the next expected run and a "Processed" event indicating when the script last ran.

    ```bash
    python caltest.py -i "your_calendar_id@group.calendar.google.com" -f "bins.json"
    ```
    Replace `"your_calendar_id@group.calendar.google.com"` with your actual Google Calendar ID. You can find this in your Google Calendar settings (usually under "Integrate calendar").

### Utility Scripts

*   **`hello.py`**: A simple script to test adding a single event to your Google Calendar. Useful for verifying your Google Calendar API setup.
    ```bash
    python hello.py -i "your_calendar_id@group.calendar.google.com"
    ```

*   **`pickle2hex.py` and `pickler.py`**:
    *   `pickle2hex.py`: Converts the `token.pickle` file into a hex-encoded string. This can be useful if you need to store the token content as a string (e.g., in a GitHub Secret or environment variable).
        ```bash
        # Modify the script to point to your token.pickle if it's not in the default location
        python pickle2hex.py
        # The output will be in C:/Users/Tom/.credentials/token.pickled (or as modified in the script)
        ```
    *   `pickler.py`: Converts a hex-encoded string (read from stdin) back into a `token.pickle` file. This is used to recreate the `token.pickle` file from its string representation.
        ```bash
        echo "your_hex_encoded_token_string" | python pickler.py
        # This will create token.pickle in the current directory.
        ```
        This is particularly useful in automated environments like GitHub Actions where you might store the token as a secret.

## Automation with GitHub Actions

This repository includes a GitHub Actions workflow defined in `.github/workflows/python-app.yml` that automates the process of fetching bin data and updating your Google Calendar.

### Workflow Details

*   **Triggers**: The workflow can be triggered:
    *   Manually from the GitHub Actions tab.
    *   On every push to the `main` branch.
    *   On pull requests targeting the `main` branch.

*   **Process**:
    1.  Sets up a Linux environment with Python 3.10.
    2.  Installs Google Chrome and the corresponding ChromeDriver.
    3.  Installs necessary Python libraries (`selenium`, `gcsa`, and others from `requirements.txt`).
    4.  Runs `bins.py` using `HOUSENO` and `POSTCODE` values stored as GitHub Secrets. The resulting `bins.json` is uploaded as a workflow artifact.
    5.  Runs `caltest.py`:
        *   It recreates `credentials.json` from a `CRED` GitHub Secret.
        *   It recreates `token.pickle` from a `TOKEN` GitHub Secret (which should be the hex-encoded string of your `token.pickle` file) using `pickler.py`.
        *   It then updates the Google Calendar specified by the `CALID` GitHub Secret using the `bins.json` artifact.

### Required Secrets for GitHub Actions

To use the GitHub Actions workflow, you need to configure the following secrets in your repository settings (`Settings > Secrets and variables > Actions`):

*   `HOUSENO`: Your house number/name.
*   `POSTCODE`: Your postcode.
*   `CALID`: Your Google Calendar ID.
*   `CRED`: The content of your `credentials.json` file.
*   `TOKEN`: The hex-encoded string of your `token.pickle` file. You can generate this using `pickle2hex.py` locally, then copy the output string.

## Troubleshooting / Known Issues

*   **Council Website Changes**: The `bins.py` script relies on the specific HTML structure of the Gateshead Council's bin collection page. If the website is updated, the script may fail to find the correct elements. This would require updating the selectors (e.g., `By.ID`, `By.CLASS_NAME`) in `bins.py`.
*   **ChromeDriver Version**: `bins.py` requires ChromeDriver. If you encounter errors related to ChromeDriver, ensure:
    *   It's installed and its version matches your Google Chrome/Chromium browser version.
    *   It's in your system's PATH or the path to the executable is correctly specified in `bins.py`.
    *   The GitHub Actions workflow pins specific versions, which might need updating if they become too old.
*   **Google Calendar API Quotas**: Excessive use of the Google Calendar API might lead to quota limits. For personal use, this is unlikely, but it's something to be aware of.
*   **Authentication Issues (`token.pickle` / `credentials.json`)**:
    *   Ensure `credentials.json` is correctly obtained from Google Cloud Console and placed in the root directory for local runs.
    *   `token.pickle` is generated after the first successful authorization. If it gets corrupted or you revoke access, delete `token.pickle` and re-authorize.
    *   For GitHub Actions, ensure the `CRED` and `TOKEN` secrets are correctly populated. The `TOKEN` secret must be the hex-encoded *string* from `pickle2hex.py`, not the binary `token.pickle` file itself.
*   **Timezone Issues**: The scripts assume UK/London timezone settings. If you are in a different timezone or the target calendar uses a different one, you might need to adjust timezone settings in `bins.py` (for Selenium geolocation/timezone override) and `caltest.py` (for `gcsa.Event` timezone).

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details (if a LICENSE file is added).

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
